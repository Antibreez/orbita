# 1. [Общая структура проекта](#общая-структура)

# 2. [UI-KIT](#ui-kit)

# 3. [API внешнего взаимодействия с интерактивными элементами](#api-внешнего-взаимодействия-с-интерактивными-элементами)

## Общая структура

- ### `source` (папка с файлами для разработки)

**/components** - переиспользуемые компоненты (подробнее в разделе UI-KIT).

**/fonts** - используемые шрифты, переносятся в **build/fonts**

**/img** - картинки. Картинки в корне переносятся в **build/img**. Svg в папке icons собираются в **sprite.svg** и переносится в **build/img**

**/js** - файлы из папки **libs** попадают в сжатый файл **vendor.js** в **build/js**. Файлы из папок **source/js/utils**, **source/js/common**, **source/components**, **source/js/modules** (в таком порядке) собираются в файл **main.js** (не сжатый) и **main.min.js** (сжатый) в **build/js**

**/scss** - файлы стилей. Входная точка **scss/style.scss**. Итоговый файл помещается в **build/css/style.css**

**/** - в корне папки **source** находятся **html** файлы. **index.html** - входной файл со ссылками на все страницы. Файлы, начинающиеся с двух тире (например, **--button.html**) - это страницы соответствующих по названию компонентов, т.е. в данном примере это страница с кнопками. Файлы **html** в сжатом виде попадают в корень папки **build**, а в папку **build/html-original** попадают не оптимизированные (читабельные) файлы.

&nbsp;

&nbsp;

## UI-KIT

- ### [Общие положения](#общие-положения-1)
- ### [Инпут загрузки файла](#инпут-загрузки-файла-1)
- ### [Формы](#формы-1)
- ### [Селект](#селект-1)
- ### [Слайдер](#слайдер-1)
- ### [Пины на карте](#пины-на-карте-1)
- ### [Модалки](#модалки-1)

&nbsp;

### **Общие положения**

### В проекте определы переменные дизайн-системы:

- **брейкпоинты адаптивности**

`source/scss/global/variables` - значения брейкпоинтов

`source/scss/global/mixins` - медиа-запросы по брейкпоинтам

- **цвета**

`source/scss/global/variables` - значения цветов

- **градиенты**

`source/scss/global/variables` - значения цветов для градиентов

`source/scss/global/functions` - функции задающие градиенты для фонов элементов

- **шрифты**

`source/scss/global/mixins` - определение параметров шрифтов. Именование идет по макету (h1, h2, h3... b1, b2)

### Сделаны отдельные ui-компоненты:

Папка **source/components** содержит папки с компонентами. Каждый компонент (папка) содержит разметку, стили (**scss** используемый для разработки и **css**, который сразу можно использовать) и **js** (опционально), **js** требует наличие библиотеки **jQuery**. В некоторых компонентах используется библиотека [gulp-file-include](https://www.npmjs.com/package/gulp-file-include), так как содержимое html (блоки разметки, классы) могут зависеть от условий. Пример из компонента **header**:

```
<ul class="header__nav-list">
  <li class="header__nav-item">
    <a href="#" class="header__nav-link @@if (page === 'production') {active}">Продукция</a>
  </li>
  ...
</ul>
```

Здесь есть условие - если страница **production**, то у пункта меню будет класс **active**

На странице, использование компонента **header** будет выглядеть так:

```
@@include('./components/header/header.html', { page: 'production' })
```

&nbsp;

### **Инпут загрузки файла**

Необходимо создать экземпляр класса `FileInput`

```
const input = new FileInput('input-test', rules)
```

Первым аргументом передается атрибут `name` инпута

```
<input type="file" ... name="input-test" ...>
```

Вторым аргументом передается **массив** дополнительных правил валидации поля

Поле содержит стандартную валидацию:

1. Валидация типа файла.

Если инпут содержит атрибут `accept`, то идет проверка по типам перечисленным в атрибуте

```
<input type="file" ... accept="image/jpeg,image/png,image/gif" ...>
```

2. Валидация рамера файла.

Если инпут содержит атрибут `data-max-bytes` (указывает максимально допустимый размер в **байтах**), то идет проверка на превышение размера загружаемого файла допустимого значения

```
<input type="file" ... data-max-bytes="1000000" ...>
```

Воторой передаваемый аргумент в экземпляр класса позволяет задать массив дополнительных валидаций. Каждый элемент массива это объект, который должен содержать поля:

- **isCorrect** - функция, которая в качестве параметра содержит сам инпут. В теле функции можно производить проверки с файлом (**input.files[0]**). Функция должна возвращать значение булева типа, **true** - поле валидно, **false** - поле невалидно
- **text** - строка, текст ошибки, который будет отображаться

Пример использования дополнительных валидаций:

```
const input = new FileInput('file-test', [
  {
    isCorrect: input => {
      return input.files[0].name.toLowerCase().includes('файл')
    },
    text: 'Название файла должно содержать "Файл"',
  },
])
```

Дополнительную валидацию можно добавлять позже, используя метод `addRules`

```
const input = new FileInput('file-test')
```

```
input.addRules([
  {
    isCorrect: input => {
      return input.files[0].name.toLowerCase().includes('файл')
    },
    text: 'Название файла должно содержать "Файл"',
  },
])
```

Например, сначала на фронте создается базовый экземпляр инпута. Позже разработчик, внедряющий верстку, добавляет дополнительные правила

Также есть метод `clearRules`. удаляющий все дополнительные правила (и объявленные при создании инпута, и добавленные позже методом `addRules`)

&nbsp;

### **Формы**

Необходимо создать экземпляр класса `form`, в который аргументом передается **id** формы

```
const exampleForm = new Form('#form-example')
```

Формы имеют валидацию, проверяются все поля с атрибутом `data-required`

```
<input ... data-required ...>

```

Поля **email** и **телефонных номеров** имеют стандартную валидацию

Обычному текстовому полю (type="text"), можно задать особую валидацию, задав в атрибуте `pattern` регулярное выражение, тогда валидация поля будет осуществлятся по этому выражению, например:

```
<input ... pattern="^(?!\s*$).+" ...>
```

&nbsp;

### **Селект**

Предусмотрен метод инициализации всех селектов на странице:
```
initAllSelect2()
```

и метод инициализации селекта по классу:
```
initSelect2ByClass('.branches__filters-item select')
```
есть защита от повторной инициализации селекта, код не упадёт, а в консоли будет предупреждение

&nbsp;

### **Слайдер**

Есть метод инициализации слайдера. Так как многие слайдеры отличаются опциями, которые указываются при инициализации, плюс эти опции бывают очень объемным, я сделал глобальный объект `globalSwiperStorage`, который хранит все изначально инициализированные слайдеры.

В этом объекте по классу (являющийся ключом) можно обратиться к объекту слайдера и вызвать метод инициализации, который инициализирует слайдер с первоначальными опциями:
```
globalSwiperStorage['.main-slider__slides'].init()
```
Метод `init` без аргументов повторно инициализирует слайдер с теми же опциями. Но он также может принимать объект с возможными необязательными полями: `newOptions`(Object) и `callback`(Function). В `newOptions` можно переопределить по отношению к изначальным какие-либо опции слайдера. `callback` позволяет добавить коллбэк после инициализации. Пример:
```
globalSwiperStorage['.main-slider__slides'].init(
  {
    newOptions: {
      autoplay: false
    },
    callback: function () {
      $('.main-slider__slides').prev().addClass('is--no-autoplay')
    }
  }
);
```
Убираем автоплей у слайдера и передаем коллбек, добавляющий класс
&nbsp;
### **Пины на карте**
Есть метод обновления пинов на карте (полная перерисовка)
```
setCompanyMapBranches([
  ...
  {
    x: Float,
    y: Float,
    name: String,
    address: String,
    telephone: String,
    email: String,
    link: String
  }
  ...
])
```
И метод добавления пинов к существующим
```
addCompanyMapBranches([
  ...
  {
    x: Float,
    y: Float,
    name: String,
    address: String,
    telephone: String,
    email: String,
    link: String
  }
  ...
])
```
&nbsp;
### **Модалки**
**Метод вызывающий стандартную успешную модалку**

Все параметры необязательные
```
openRequestSuccessModal({
  className: String, // задает класс модалке, по умолчанию undefined
  header: String, // заголовок в шапке, по умолчанию undefined
  title: String, // заголовок в теле, по умолчанию 'Обращение отправлено!'
  desc: String, // описание, по умолчанию 'В&nbsp;ближайшее время с&nbsp;вами свяжется наш&nbsp;менеджер'
})
```
**Метод вызывающий стандартную неуспешную модалку**

Все параметры необязательные
```
openRequestFailurModal({
  className: String, // задает класс модалке, по умолчанию undefined
  header: String, // заголовок в шапке, по умолчанию undefined
  title: String, // заголовок в теле, по умолчанию 'Произошла ошибка!'
  desc: String, // описание, по умолчанию ''
})
```
**Метод вызывающий кастомную модалку**

Требуется по крайней мере один параметр: **header**, **title** или **desc**
```
openCustomModal({
  className: String, // задает класс модалке, по умолчанию undefined
  header: String, // заголовок в шапке, по умолчанию undefined
  title: String, // заголовок в теле, по умолчанию undefined
  desc: String, // описание, по умолчанию undefined
})
```
**Метод открывающий шаблонную модалку, в которой требуется подставить динамические данные**

В шаблоне вместо строк указанных в виде `#data#` подставляется строка соответствующего аргумента `data: ....`
```
<div id="test_modal">
  <div class="h5 modal__title">#title#</div>
  <div class="modal__desc">#desc#</div>
</div> 

openTemplateModal(
  #templateId, // id модалки
  {
    title: String,
    desc: String
  }
)
```
**Закрытие активной модалки:**
```
closeActiveModal()
```
**Закрытие всех открытых модалок:**
```
closeAllModals()
```


&nbsp;

&nbsp;

## API внешнего взаимодействия с интерактивными элементами

- ### [модалка выбора города](#модалка-выбора-города-1)
- ### [поиск по сайту](#поиск-по-сайту-1)

### Модалка выбора города

source/js/modules/cityModal.js

**Для модалки создан экземпляр класса, позволяющий создавать во внешних скриптах методы с колбеками**

```
class CityModal {
  constructor() {
    this.el = $('#city-select')
  }

  onInput(cb) {
    $(document).on(
      'input',
      '#city-select .input-field input',
      debounce(e => {
        cb(this.el.find('.input-field input').val())
      }, 500)
    )
  }

  onSelect(cb) {
    $(document).on('click', '#city-select .modal__city-link', e => {
      if ($(e.target).hasClass('active')) return
      cb($(e.target).text())
    })
  }

  onClear(cb) {
    $(document).on('click', '#city-select .input-field__clear-button', e => {
      cb()
    })
  }
}

const cityModal = new CityModal()
```

**Пример использования во внешних скриптах:**

_Подписываемся на событие ввода в поиск города и передаем нужный колбэк со значением инпута:_

```
cityModal.onInput(function (val) {
    // Выполняем запрос со значением инпута val
    $.ajax('https://jsonplaceholder.typicode.com/todos/1').done(data => {
      console.log(val)
    })
  })
```

_Подписываемся на событие выбора города и передаем нужный колбэк, в котором закрываем модалку после запроса:_

```
cityModal.onSelect(function (val) {
    // Выполняем запрос со значением города val
    $.ajax('https://jsonplaceholder.typicode.com/todos/1').done(data => {
      console.log(val)
      // После завершения запроса закрываем модалку
      $.fancybox.close()
    })
})
```

_Подписываемся на событие очистки поля ввода поиска города (клик на крестик) и передаем колбэк:_

```
cityModal.onClear(function () {
    // Запрос при очистке поля поиска
    $.ajax('https://jsonplaceholder.typicode.com/todos/1').done(data => {
      console.log('Search clear')
    })
})
```

### Поиск по сайту

source/js/modules/mainSearchModal.js

**Для модалки поиска создан экземпляр класса, позволяющий создавать во внешних скриптах методы с колбеками**

```
onInput(cb) {
    $(document).on(
      'input',
      '#search-main .input-field input',
      debounce(e => {
        cb($(e.target).val())
      }, 500)
    )
}

onClear(cb) {
    $(document).on('click', '#search-main .input-field__clear-button', e => {
      cb()
    })
}
```

**Пример использования во внешних скриптах:**

_Подписываемся на событие ввода в поиск по сайту и передаем нужный колбэк со значением инпута:_

```
mainSearchModal.onInput(function (val) {
    // Выполняем запрос со значением инпута val
    $.ajax('https://jsonplaceholder.typicode.com/todos/1').done(data => {
      console.log(val)
    })
  })
```

_Подписываемся на событие очистки поля ввода поиска (клик на крестик) и передаем колбэк:_

```
mainSearchModal.onClear(function () {
    // Запрос при очистке поля поиска
    $.ajax('https://jsonplaceholder.typicode.com/todos/1').done(data => {
      console.log('Search clear')
    })
})
```
